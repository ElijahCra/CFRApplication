# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Build Commands

**Primary build from root directory:**
```bash
cmake -S . -B cmake-build-debug
cmake --build cmake-build-debug
```

**Release build:**
```bash
cmake -S . -B cmake-build-release -DCMAKE_BUILD_TYPE=Release
cmake --build cmake-build-release
```

**Run GUI application:**
```bash
./cmake-build-debug/CFRApp
```

**Run CFR algorithm directly:**
```bash
./cmake-build-debug/2PlayerCFR/2PlayerCFR
```

**Run tests:**
```bash
cd cmake-build-debug
ctest
# Or run test executable directly:
./2PlayerCFR/Test/Test/hello_test
```

## Architecture Overview

This is a **Counterfactual Regret Minimization (CFR)** implementation for 2-player poker games with both a Qt GUI interface and a command-line algorithm runner.

### Core Components

1. **CFRApp (Qt GUI)** - Main Qt application providing visual interface for CFR training
   - Uses Qt6 with custom widgets and worker threads
   - Files: `main.cpp`, `mainwindow.cpp`, `Controller.cpp`, `Worker.hpp`, `MyWorker.hpp`

2. **2PlayerCFR (Algorithm Core)** - The CFR algorithm implementation
   - Entry point: `2PlayerCFR/main.cpp` runs RegretMinimizer training
   - Uses template-based design for different game types

### Key Subsystems

**CFR Engine (`2PlayerCFR/CFR/`)**
- `RegretMinimizer<GameType>` - Main CFR algorithm template class
- `Node` - Information set nodes with regret/strategy tracking
- `HybridNodeStorage` + `RocksDBNodeStorage` - Persistent node storage with LRU caching
- `NodeSerializer` - Serialization for node persistence

**Game Implementations (`2PlayerCFR/Game/GameImpl/`)**
- `Preflop::Game` - Simplified preflop-only poker
- `Texas::Game` - Full Texas Hold'em implementation
- Both inherit from `GameBase` and use state pattern for game phases

**Hand Evaluation (`2PlayerCFR/Game/Utility/`)**
- `TwoPlusTwoHandEvaluator` - Fast hand strength evaluation
- `HandAbstraction` - Card abstraction utilities
- `HandRanks.dat` - Precomputed hand rankings (auto-generated)

### Storage Architecture

The CFR algorithm uses a hybrid storage system:
- In-memory LRU cache for frequently accessed nodes
- RocksDB persistent storage for the complete game tree
- Automatic serialization/deserialization of node data

### Game State Management

Games use a state pattern with concrete states:
- `ChanceState` - Random card dealing
- `ActionStateNoBet`/`ActionStateBet` - Player decision points  
- `TerminalState` - End-of-hand payoff calculation

### Threading Model

The Qt GUI uses a worker thread pattern (`Controller`/`MyWorker`) to run CFR training without blocking the UI.

## Development Notes

- **C++ Standards**: Main app uses C++23, CFR core uses C++20
- **Dependencies**: Qt6 (GUI), RocksDB (storage), GoogleTest (testing)
- **Hand Ranks**: `HandRanks.dat` is auto-generated by `generate_table` if missing
- **Database**: CFR nodes are persisted in `cfr_nodes_db/` directory
- **Testing**: Uses GoogleTest framework with `hello_test` executable